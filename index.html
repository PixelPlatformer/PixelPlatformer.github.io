<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Platformer Online</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Tiny5&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    
    <style>
        body {
            margin: 0; padding: 0; background-color: #050505; color: #fff;
            font-family: 'Tiny5', sans-serif; overflow: hidden;
            display: flex; justify-content: center; align-items: center; height: 100vh;
            user-select: none; perspective: 1000px;
        }

        /* --- BACKGROUND PARTICLES --- */
        #particle-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .particle { position: absolute; background: rgba(255, 255, 255, 0.1); opacity: 0; }
        .triangle { width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-bottom: 35px solid rgba(255,255,255,0.1); background: transparent; }
        @keyframes floatUp { 
            0% { transform: translateY(110vh) rotate(0deg); opacity: 0; } 
            20% { opacity: 0.8; } 
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; } 
        }

        /* --- UI CONTAINERS --- */
        .menu-screen {
            position: relative; z-index: 10; text-align: center;
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s ease-out;
            background: rgba(0, 0, 0, 0.6);
            padding: 40px;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }

        /* Title Style */
        h1 {
            font-size: 80px; margin: 0 0 30px 0; color: #fff; line-height: 0.8;
            text-transform: uppercase;
            text-shadow: 0 0 10px #fff, 0 0 20px #aaeeff;
            transform-style: preserve-3d;
            animation: titleFloat 4s ease-in-out infinite;
        }

        h2 { font-size: 40px; color: #aaeeff; margin-bottom: 20px; text-shadow: 0 0 10px #aaeeff; }
        p { font-size: 20px; color: #ccc; }

        /* Button Style */
        .btn {
            display: block; width: 300px; margin: 15px auto;
            background: rgba(0,0,0,0.5); color: #fff;
            font-family: 'Tiny5', sans-serif; font-size: 24px;
            padding: 12px; border: 3px solid #fff; cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
            transition: 0.2s; text-transform: uppercase;
        }
        .btn:hover { background: #fff; color: #000; box-shadow: 0 0 25px #fff; transform: scale(1.05); }

        /* Inputs */
        input {
            background: #222; border: 2px solid #fff; color: #fff;
            font-family: 'Tiny5', sans-serif; font-size: 24px;
            padding: 10px; width: 200px; text-align: center;
            outline: none; margin-bottom: 20px;
        }
        input:focus { border-color: #00ffcc; box-shadow: 0 0 15px #00ffcc; }

        /* Code Display Box */
        .code-box {
            font-size: 40px; color: #00ffcc; border: 2px dashed #00ffcc;
            padding: 10px; margin: 20px 0; background: rgba(0, 255, 204, 0.1);
            user-select: text; letter-spacing: 5px;
        }

        /* --- ANIMATIONS --- */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes titleFloat { 
            0% { transform: rotateY(-10deg) rotateZ(-2deg); } 
            50% { transform: rotateY(10deg) rotateZ(2deg); } 
            100% { transform: rotateY(-10deg) rotateZ(-2deg); } 
        }

        /* Game Canvas */
        #game-container { display: none; }
        canvas { background: #111; border: 2px solid #555; box-shadow: 0 0 30px rgba(255,255,255,0.1); }
    </style>
</head>
<body>

    <div id="particle-container"></div>

    <div id="loading-screen" style="position:fixed; width:100%; height:100%; background:#000; z-index:999; display:flex; justify-content:center; align-items:center; flex-direction:column;">
        <div style="font-size:30px; animation: pulse 1s infinite; text-shadow:0 0 10px white;">LOADING SYSTEM...</div>
    </div>

    <div id="menu-main" class="menu-screen">
        <h1>Pixel<br>Platformer</h1>
        <button class="btn" onclick="startGame('single')">Single Player</button>
        <button class="btn" onclick="showScreen('menu-multi')">Multiplayer</button>
    </div>

    <div id="menu-multi" class="menu-screen">
        <h2>Multiplayer Mode</h2>
        <button class="btn" onclick="hostGame()">Host Game</button>
        <button class="btn" onclick="showScreen('menu-join')">Join Game</button>
        <br>
        <button class="btn" onclick="showScreen('menu-main')" style="border-color:#ff5555; font-size: 20px;">Back</button>
    </div>

    <div id="menu-host" class="menu-screen">
        <h2>Lobby Created</h2>
        <p>Share this code with your friend:</p>
        <div id="my-code" class="code-box">...</div>
        <p id="host-status">Waiting for player...</p>
        <button class="btn" onclick="location.reload()" style="border-color:#ff5555;">Cancel</button>
    </div>

    <div id="menu-join" class="menu-screen">
        <h2>Join Game</h2>
        <p>Enter Host Code:</p>
        <input type="text" id="join-code-input" placeholder="CODE" maxlength="5">
        <button class="btn" onclick="joinGame()">Connect</button>
        <button class="btn" onclick="showScreen('menu-multi')" style="border-color:#ff5555; font-size: 20px;">Back</button>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="500"></canvas>
    </div>

    <script>
        // --- VISUAL FX ---
        // Floating Particles Logic
        const pContainer = document.getElementById('particle-container');
        setInterval(() => {
            const p = document.createElement('div');
            p.classList.add('particle');
            if(Math.random() > 0.5) p.classList.add('triangle');
            else {
                p.style.width = (Math.random()*30+10)+'px';
                p.style.height = (Math.random()*30+10)+'px';
            }
            p.style.left = Math.random()*100+'vw';
            p.style.animation = `floatUp ${Math.random()*3+4}s linear infinite`;
            pContainer.appendChild(p);
            setTimeout(() => p.remove(), 7000);
        }, 200);

        // Fake Loading Screen
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('loading-screen').style.display = 'none';
                showScreen('menu-main');
            }, 1500);
        };

        function showScreen(id) {
            document.querySelectorAll('.menu-screen').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        }

        // --- MULTIPLAYER LOGIC (PeerJS) ---
        let peer = null;
        let conn = null;
        let isHost = false;

        // Generate a random 4-digit code (simple letters)
        function generateId() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let result = '';
            for (let i = 0; i < 4; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
            return result;
        }

        function hostGame() {
            showScreen('menu-host');
            const myID = generateId();
            document.getElementById('my-code').innerText = myID;

            // Initialize Peer
            peer = new Peer(myID);

            peer.on('open', (id) => {
                console.log('My peer ID is: ' + id);
            });

            // Wait for connection
            peer.on('connection', (c) => {
                conn = c;
                document.getElementById('host-status').innerText = "Player Connected!";
                document.getElementById('host-status').style.color = "#00ffcc";
                
                // Wait 1 second then start game
                setTimeout(() => {
                    startGame('multi-host');
                }, 1000);
            });
        }

        function joinGame() {
            const code = document.getElementById('join-code-input').value.toUpperCase();
            if(code.length < 4) return alert("Please enter a valid code");

            peer = new Peer(); // Joiners don't need a specific ID
            
            peer.on('open', (id) => {
                conn = peer.connect(code);

                conn.on('open', () => {
                    console.log("Connected to: " + code);
                    startGame('multi-client');
                });

                conn.on('error', (err) => {
                    alert("Connection Failed. Check Code.");
                });
            });
        }

        // --- GAME ENGINE PLACEHOLDER ---
        function startGame(mode) {
            document.querySelectorAll('.menu-screen').forEach(s => s.style.display = 'none');
            document.getElementById('game-container').style.display = 'block';
            
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // Just drawing text to prove it worked for now
            ctx.fillStyle = "white";
            ctx.font = "30px Tiny5";
            ctx.fillText("MODE: " + mode.toUpperCase(), 50, 50);
            
            if (mode === 'multi-host') ctx.fillText("You are the HOST", 50, 100);
            if (mode === 'multi-client') ctx.fillText("You are the CLIENT", 50, 100);
            
            // Next step: We will add the actual platformer loop here
        }
    </script>
</body>
</html>
